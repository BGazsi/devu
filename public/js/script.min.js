function toggleClass(e,t){e.hasClass(t)?e.removeClass(t):e.addClass(t)}function changeFavoriteIcon(e){toggleClass(e.find(".icon-fav i"),"fa-heart"),toggleClass(e.find(".icon-fav i"),"fa-heart-o")}function changeFavoriteText(e){$.each(e.find(".favorite-text"),function(e,t){toggleClass($(t),"invisible")})}function setFavoriteIcons(e){e.each(function(e,t){if($(t).data("is-favorite")<0){var a=$("i",$(t));a.removeClass("fa-heart"),a.addClass("fa-heart-o")}})}function favoriteInit(){var e=$('[data-component~="favorite"]');setFavoriteIcons(e),e.on("click",function(e){e.stopImmediatePropagation();var t=$(e.currentTarget).children("i"),a=[];$(".place-favoritable").each(function(e,n){$(n).data("place-id")==t.closest(".place-favoritable").data("place-id")&&a.push($(n))}),$.post({url:"/user/addFavorite/"+t.closest(".place-favoritable").data("place-id"),error:function(){$.growl.error({title:"Hiba!",message:"Kedvencnek jelöléshez be kell jelentkezned!"})},success:function(){"changeIcon"==t.data("component")&&$(a).each(function(e,t){changeFavoriteIcon($(t)),0===e&&$(document).trigger("gtm",{event:"General Event",eventAction:$(t).find(".icon-fav i").hasClass("fa-heart-o")?"removeFavorite":"addFavorite",eventCategory:"favorite",eventLabel:$(t).find("h4").text()})}),"changeText"==t.data("component")&&$(a).each(function(e,a){changeFavoriteText($(a).parent()),0===e&&$(document).trigger("gtm",{event:"General Event",eventAction:t.next(".add-text").hasClass("invisible")?"addFavorite":"removeFavorite",eventCategory:"favorite",eventLabel:$('h3[itemprop~="name"]').text()})}),$.growl({title:"Köszönjük!",message:"Sikeres mentés!"})}})})}function searchByTags(){$.post({url:"/place/search",error:function(e){console.log(e),sessionStorage.removeItem("search")},success:function(e){$(".list").html(e),favoriteInit()},data:{tags:JSON.parse(sessionStorage.getItem("search"))}})}function removeOldSubscribes(e){e.off("click")}function searchInit(){$("#tags").find("option").each(function(e,t){if(sessionStorage.getItem("search").indexOf($(t).val())!==-1){var a='<div class="btn-group"><button type="button" class="btn btn-xs btn-default btn-tag" data-value="'+$(t).val()+'">',n='</button><button type="button" class="btn btn-xs btn-default" data-component="remove-tag"><i class="fa fa-times" aria-hidden="true"></i></button></div>';$(".added-tags").append(a+$(t).text()+n),$(t).remove()}})}function removeTagInit(){$('[data-component~="remove-tag"]').on("click",function(e){$("#tags").append('<option value="'+$(e.currentTarget).prev(".btn").data("value")+'">'+$(e.currentTarget).prev(".btn").text()+"</option>"),$(e.currentTarget).closest(".btn-group").remove(),$('[data-component~="add-tag-on-upload"]').length>0&&$("#added-tags option").each(function(t,a){$(a).val()==$(e.currentTarget).prev(".btn-tag").data("value")&&$(a).prop("selected",!1)})})}$(document).ready(function(){$('[data-toggle="popover"]').popover(),$(".container").hasClass("home")&&null!==sessionStorage.getItem("search")&&(searchByTags(),searchInit()),favoriteInit(),removeTagInit(),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){localStorage.setItem("lastTab",$(this).attr("href"))}),$('[data-component="upload"]').on("click",function(e){$(document).trigger("gtm",{event:"General Event",eventAction:"recommendPlace",eventCategory:"recommend",eventLabel:$('input[name="name"]').val()})}),$('[data-component="favorites-list"]').on("click",function(e){$(document).trigger("gtm",{event:"General Event",eventAction:"favoritesList",eventCategory:"favorite"})}),$('[data-component="logout"]').on("click",function(e){$(document).trigger("gtm",{event:"General Event",eventAction:"logout",eventCategory:"userInteraction"})}),$('[data-component="login"]').on("click",function(e){$(document).trigger("gtm",{event:"General Event",eventAction:"login",eventCategory:"userInteraction"})}),$('[data-component="fb-login"]').on("click",function(e){$(document).trigger("gtm",{event:"General Event",eventAction:"facebookLogin",eventCategory:"userInteraction"})});var e=localStorage.getItem("lastTab");e&&$('[href="'+e+'"]').tab("show"),$(".delete-tag").on("click",function(e){return!!confirm("Biztosan törlöd?")&&void $(e.currentTarget).next("form").submit()}),$(".img-gradient").on("click",function(e){window.location.replace($(e.target).find("a").attr("href"))});var t=$(".rating-radio-label");t.on("mouseover",function(e){$(e.currentTarget).find("i").addClass("hovered"),$(e.currentTarget).prevAll(".rating-radio-label").find("i").addClass("hovered")}),t.on("mouseleave",function(e){$(e.currentTarget).find("i").removeClass("hovered"),$(e.currentTarget).prevAll(".rating-radio-label").find("i").removeClass("hovered")}),$('[data-component="rating-click-listener"]').on("click",function(e){var t=$(e.currentTarget).closest("label").next();t.parent().find("i").removeClass("selected"),t.prop("checked",!0),t.prevAll(".rating-radio-label").find("i").addClass("selected"),$("#rating-form").submit()});for(var a=0;a<=$(".rate-yourself").data("rated-value");a++)$(".rating-radio-label:nth-of-type("+a+")").find("i").addClass("selected");$("#rating-form").submit(function(e){e.preventDefault();var t=$(".devu-container").data("place-id"),a=$(e.currentTarget).find('input[name="rating_value"]:checked').val();$.post({url:"/place/rate/"+t,error:function(){$.growl.error({title:"Hiba!",message:"Értékeléshez be kell jelentkezned!"})},success:function(e){e=JSON.parse(e),$(".male > span").html(e.maleRating.toFixed(1)),$(".female > span").html(e.femaleRating.toFixed(1)),$(".main-rating").html(e.aggregateRating.toFixed(1)),$.growl({title:"Köszönjük!",message:"Sikeres értékelés!"}),$(document).trigger("gtm",{event:"General Event",eventAction:"saveRating",eventCategory:"ratings",eventLabel:a})},data:{value:a}})}),$('[data-component~="add-to-filter"]').on("click",function(e){var t=$("#tags").find(":selected");if(!t.text())return!1;var a='<div class="btn-group"><button type="button" class="btn btn-xs btn-default btn-tag" data-value="'+t.val()+'">',n='</button><button type="button" class="btn btn-xs btn-default" data-component="remove-tag"><i class="fa fa-times" aria-hidden="true"></i></button></div>';$(".added-tags").append(a+t.text()+n),t.remove(),removeOldSubscribes($('[data-component~="remove-tag"]')),removeTagInit()}),$('[data-component~="filter-button"]').on("click",function(){var e={},t="";$(".added-tags .btn-tag").each(function(a,n){e[a]=$(n).data("value"),t+=t.length?" | "+$(n).text():$(n).text()}),sessionStorage.setItem("search",JSON.stringify(e)),searchByTags(),$(document).trigger("gtm",{event:"General Event",eventAction:"searchByTags",eventCategory:"search",eventLabel:t})}),$('[data-component~="add-tag-on-upload"]').on("click",function(){$(".added-tags").find(".btn-tag").each(function(e,t){$("#added-tags option").each(function(e,a){$(a).val()==$(t).data("value")&&$(a).prop("selected","selected")})})}),$(".top-place-item.place-favoritable").on("click",function(e){window.location.replace("/place/"+$(e.currentTarget).data("place-id"))}),$(".img-small").on("click",function(e){var t=$(e.currentTarget),a=t.find("img").attr("src");$(".main-img").find("img").attr("src",a)})});